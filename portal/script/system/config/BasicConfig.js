ufgov.portal.system.BasicConfig=function(){};Ext.extend(ufgov.portal.system.BasicConfig,ufgov.portal.Base,{pageInit:function(){this.createMainFrame();this.createOperFrame()},createMainFrame:function(){var b=new Ext.Panel({layout:"border",border:false,items:[{region:"center",border:false,layout:"fit",margins:"0 0 0 0",items:[{border:false,region:"center",id:"basicParams",html:'<div id="basicParams" style="width:100%"></div>'}]}]});var a=new Ext.Panel({layout:"fit",id:"basicConfig",applyTo:"basicConfig",border:false,items:b});window.onresize=function(){b.setWidth(0);b.setWidth(Ext.getCmp("basicConfig").getInnerWidth())}},selectTheme:function(){BasicConfig.showMsg("温馨提示","抱歉，此功能目前还没有提供！")},createOperFrame:function(){var c="addBasicConfig";var h=new Ext.Panel({border:false,layout:"table",autoHeight:true,defaults:{bodyStyle:"padding:5px"},layoutConfig:{columns:3},buttonAlign:"center",items:[{layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"门户名称",labelStyle:"text-align:right;",name:"portalName",width:150},{xtype:"hidden",name:"portalId",value:(new Date()).getTime()}]},{layout:"form",border:false,items:{xtype:"textfield",fieldLabel:"登录前宽度",labelStyle:"text-align:right;",name:"preWidth",width:100}},{layout:"form",border:false,items:{xtype:"textfield",fieldLabel:"登录后宽度",labelStyle:"text-align:right;",name:"sufWidth",width:100}},{layout:"form",border:false,items:{xtype:"textfield",fieldLabel:"门户URL",labelStyle:"text-align:right;",name:"portalUrl",width:150}},{layout:"form",border:false,items:{xtype:"combo",fieldLabel:"主题风格",labelStyle:"text-align:right;",store:new Ext.data.SimpleStore({data:[["default","默认主题"],["gray","灰色主题"],["blue","蓝色星空"],["green","绿色主题"],["silverCherry","银色欢乐"],["indigo","indigo"],["slate","slate"]],fields:[{name:"themeCode"},{name:"showName"}]}),id:"themeCodeCombo",valueField:"themeCode",displayField:"showName",hiddenName:"themeCode",value:"default",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",editable:false,allowBlank:false,width:120,height:30,selectOnFocus:true,listeners:{select:function(o,k,l){if(k.data.themeCode!="default"){var n="xtheme-"+k.data.themeCode+".css";var m=path+"/html/themes/"+k.data.themeCode+"/css/"+n;Ext.util.CSS.swapStyleSheet("themes",m)}else{Ext.util.CSS.swapStyleSheet("themes","")}}}}}]});var b=new Ext.grid.CheckboxSelectionModel();var j=new Ext.grid.ColumnModel([b,{id:"funcId",header:"代码",align:"center",width:50,sortable:true,dataIndex:"funcId"},{id:"funcName",header:"功能名称",align:"center",width:150,sortable:true,dataIndex:"funcName"},{id:"imgURL",header:"图片地址",align:"center",sortable:true,dataIndex:"imgURL",editor:new Ext.form.TextField({allowBlank:true})}]);j.defaultSortable=true;var d=Ext.data.Record.create([{name:"funcId",type:"string"},{name:"funcName",type:"string"},{name:"imgURL",type:"string"}]);var e=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"html/system/config/funclink.json",method:"GET"}),reader:new Ext.data.JsonReader({root:"data",fields:[{name:"funcId",type:"string"},{name:"funcName",type:"string"},{name:"imgURL",type:"string"}]})});e.load();var g=new Ext.grid.EditorGridPanel({store:e,cm:j,sm:b,id:"editLink",autoExpandColumn:"imgURL",height:150,width:300,frame:false,clicksToEdit:1});var i=new Ext.Panel({layout:"table",title:"页头定制",border:false,defaults:{bodyStyle:"padding:5px"},layoutConfig:{columns:3},autoHeight:true,items:[{border:false,layout:"form",colspan:2,items:{xtype:"textfield",fieldLabel:"登录前Logo地址",labelStyle:"text-align:right;",name:"logoUrl",width:200}},{border:false,layout:"form",colspan:2,items:{xtype:"textfield",fieldLabel:"登录后Logo地址",labelStyle:"text-align:right;",name:"logoInUrl",width:200}},{border:false,layout:"fit",width:120,html:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>欢迎信息区：</b>"},{border:false,layout:"form",items:{xtype:"textfield",fieldLabel:"背景图片地址",labelStyle:"text-align:right;",name:"welcomeImg",width:200}},{border:false,layout:"form",items:{xtype:"textfield",fieldLabel:"文字描述",labelStyle:"text-align:right;",name:"welcome",width:200}},{border:false,layout:"fit",colspan:3,html:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>用户组区：</b>"},{border:false,layout:"fit",colspan:3,items:g}]});var f=new Ext.Panel({layout:"table",title:"版权信息",border:false,autoHeight:true,bodyStyle:"padding:5px",items:{border:false,layout:"form",items:{xtype:"textarea",fieldLabel:"版权信息",labelStyle:"text-align:right;",name:"copyRight",width:450,height:60}}});var a=new Ext.form.FormPanel({layout:"fit",id:"basicConfForm",border:false,autoHeight:true,items:[h,i,f],buttonAlign:"center",buttons:[{style:"text-align:right;",width:150,text:"保存",handler:function(){var n=Ext.getCmp("basicConfForm");var l=g.getSelectionModel().getSelections();var m="";if(l.length>0){for(var o=0;o<l.length;o++){var k=l[o].data.funcId+",";k+=l[o].data.funcName+",";k+=l[o].data.imgURL;m+=k+"@"}if(m.length>1){m=m.substring(0,m.length-1)}}if(n.getForm().isValid()){n.getForm().submit({url:"saveBasicConfig.action",params:{action:c,jsonData:m,portalId:Ext.get("portalId").dom.value},waitMsg:"正在保存数据，请稍候...",success:function(q,p){BasicConfig.showMsg("提示信息",p.result.sign)},failure:function(q,p){BasicConfig.showMsg("提示信息",p.result.sign)}})}}}]});new Ext.Panel({applyTo:"basicParams",layout:"fit",border:true,autoScroll:true,items:a});Ext.Ajax.request({url:"getJsonData.action",params:{ruleID:"portal-common.getBasicConfig"},success:function(m){var k=Ext.util.JSON.decode(m.responseText);var q="";if(k.length>0){c="editBasicConfig";Ext.get("portalName").dom.value=k[0].portal_name;Ext.get("portalId").dom.value=k[0].portal_id;Ext.get("portalUrl").dom.value=k[0].portal_url;Ext.get("preWidth").dom.value=k[0].pre_width;Ext.get("sufWidth").dom.value=k[0].suf_width;Ext.getCmp("themeCodeCombo").setValue(k[0].theme_code);Ext.get("logoUrl").dom.value=k[0].logo_url;Ext.get("logoInUrl").dom.value=k[0].logo_in_url;Ext.get("welcomeImg").dom.value=k[0].welcome_img;Ext.get("welcome").dom.value=k[0].welcome;Ext.get("copyRight").dom.value=k[0].copyright;q=k[0].func_link}var r=new Array();if(q!=""){if(q.indexOf("@")>0){var p=q.split("@");for(var o=0;o<p.length;o++){var l=p[o].split(",");if(e.data.items.length>0){for(var n=0;n<e.data.items.length;n++){if(e.data.items[n].data.funcId==l[0]){r[r.length]=n;e.data.items[n].data.imgURL=l[2];e.data.items[n].commit();break}}}}}else{var l=q.split(",");if(e.data.items.length>0){for(var n=0;n<e.data.items.length;n++){if(e.data.items[n].data.funcId==l[0]){r[r.length]=n;e.data.items[n].data.imgURL=l[2];e.data.items[n].commit();break}}}}g.getSelectionModel().selectRows(r)}}});Ext.getCmp("mainFrame").on("resize",function(){a.setWidth(0);a.setWidth(Ext.getCmp("basicParams").getInnerWidth());a.syncSize()});Ext.getCmp("basicParams").on("resize",function(){i.setWidth(0);i.setWidth(Ext.getCmp("basicParams").getInnerWidth());i.syncSize();f.setWidth(0);f.setWidth(Ext.getCmp("basicParams").getInnerWidth());f.syncSize()})}});var BasicConfig=new ufgov.portal.system.BasicConfig();Ext.onReady(function(){BasicConfig.pageInit()});