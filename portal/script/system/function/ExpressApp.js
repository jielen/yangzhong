Ext.onReady(function(){var g=new ufgov.portal.Base();var d=new Ext.TabPanel({renderTo:"expressSearch",collapsible:true,activeTab:0,resizable:true,autoWidth:true,items:[{contentEl:"divExpressFast",title:"搜索",id:"tabSrFast"}]});var p=new Ext.form.FormPanel({id:"frmSrFast",renderTo:"divExpressFast",title:"",hideLabels:false,buttonAlign:"center",labelAlign:"right",labelWidth:70,border:false,frame:false,items:[{layout:"column",bodyStyle:"padding:3px 3px 3px 3px;border:1px solid;border-width:0 0 1 0",items:[{columnWidth:0.5,layout:"form",border:false},{columnWidth:0.5,layout:"form",border:false}]}],buttons:[{text:"搜索",handler:h},{text:"重置",handler:m}]});var b=new Ext.form.TextField({fieldLabel:"用户名",name:"userId"});var a=new Ext.form.TextField({fieldLabel:"菜单编号",name:"menuId"});var y=new Ext.form.TextField({fieldLabel:"部件代码",name:"compoId"});var x=new Ext.form.TextField({fieldLabel:"显示标题",name:"displayTitle"});p.items.get(0).items.get(0).items.add(b);p.items.get(0).items.get(1).items.add(a);p.items.get(0).items.get(0).items.add(y);p.items.get(0).items.get(1).items.add(x);p.doLayout();function m(){for(nn=0;nn<p.items.get(0).items.length;nn++){for(jj=0;jj<p.items.get(0).items.get(nn).items.length;jj++){var z=p.items.get(0).items.get(nn).items.items[jj];z.setValue("")}}}var r=new Ext.form.FormPanel({id:"fmSrAdv",renderTo:"divExpressAdv",title:"",hideLabels:false,height:80,buttonAlign:"center",labelAlign:"right",labelWidth:40,frame:false,hideLabels:true,bodyStyle:"padding:5 5 5 5;",items:[{xtype:"radio",boxLabel:"新增 ",name:"rdSearchAdv",itemCls:"float1",clearCls:"allow-float",checked:true,anchor:"45%"},{xtype:"radio",boxLabel:"高级搜索1",name:"rdSearchAdv",itemCls:"float1",clearCls:"allow-float",anchor:"45%"},{xtype:"radio",boxLabel:"高级搜索6",name:"rdSearchAdv",itemCls:"float1",clearCls:"allow-float",anchor:"45%"}],buttons:[{text:"搜索",handler:k,id:"execSrAdv"},{text:"设计",handler:j,id:"createSrAdv"}]});var w=new Ext.grid.CheckboxSelectionModel();var l=new Ext.grid.ColumnModel([w,{header:"页面频道编号",dataIndex:"pgPletId",id:"pgPletId",editor:new Ext.grid.GridEditor(new Ext.form.TextField({allowBlank:false,maxLength:32}))},{header:"用户名",dataIndex:"userId",id:"userId",editor:new Ext.grid.GridEditor(new Ext.form.TextField({allowBlank:false,maxLength:32}))},{header:"菜单编号",dataIndex:"menuId",id:"menuId",editor:new Ext.grid.GridEditor(new Ext.form.TextField({allowBlank:false,maxLength:60}))},{header:"部件代码",dataIndex:"compoId",id:"compoId",editor:new Ext.grid.GridEditor(new Ext.form.TextField({allowBlank:false,maxLength:60}))},{header:"显示标题",dataIndex:"displayTitle",id:"displayTitle",editor:new Ext.grid.GridEditor(new Ext.form.TextField({allowBlank:true,maxLength:200}))}]);l.defaultSortable=true;l.setEditable(4,false);l.setEditable(1,false);l.setEditable(2,false);l.setEditable(3,false);var e=[{name:"pgPletId"},{name:"userId"},{name:"menuId"},{name:"compoId"},{name:"displayTitle"}];var o=g.getInitDs(e,"apService.getListPage_ApExpressApp","conditions,start,limit,sort,dir");o.on("beforeload",function(){if(o.modified.length>0){var z=confirm("数据被修改，确认继续操作吗?");if(z){o.modified.length=0}else{return false}}g.showSaveProgressBar("正在装载刷新数据...")});Ext.Ajax.on("requestcomplete",function(B,z,A){g.hideSaveProgressBar()});var v=10;var u=new Ext.PagingToolbar({pageSize:v,store:o,displayInfo:true,displayMsg:"显示第 {0} 条到 {1} 条数据，共 {2} 条",emptyMsg:"没有数据",items:["-",{tooltip:"刪除",iconCls:"new-tab",icon:"/style/img/gp5/ico/delete_style_g.jpg",handler:t},{tooltip:"保存",iconCls:"new-tab",icon:"/style/img/gp5/ico/commit_w.jpg",handler:s}]});function n(B,D,E){var A=document.getElementById("mainFrame");var z=640;var F=700;if(A){z=A.contentDocument?A.offsetHeight:(A.document?A.scrollHeight-10:z)}if(E&&A){F=A.contentDocument?A.offsetWidth:(A.document?A.scrollWidth:F);d.el.setWidth(F-10)}var C=0;if("tabSrFast"==d.getActiveTab().id){C=p.el.getSize().height;B.width=p.el.getSize().width}else{C=r.el.getSize().height;B.width=r.el.getSize().width}if(D){B.setWidth(d.el.getSize().width);B.setHeight(z-C-50);B.syncSize()}else{B.width=d.el.getSize().width;B.height=z-C-50;B.render()}}grid=new Ext.grid.EditorGridPanel({el:"expressContent",ds:o,cm:l,sm:w,autoExpandColumn:"displayTitle",resizable:true,bbar:u});n(grid,false);window.onresize=function(){n(grid,true)};d.on("tabchange",function(A,z){n(grid,true)});d.on("collapse",function(z){n(grid,true)});d.on("expand",function(z){n(grid,true)});Ext.getCmp("mainFrame").on("resize",function(){n(grid,true,true)});function h(){o.baseParams.limit=v;var A=new Object();for(nn=0;nn<p.items.get(0).items.length;nn++){for(jj=0;jj<p.items.get(0).items.get(nn).items.length;jj++){var z=p.items.get(0).items.get(nn).items.items[jj];if(""!=z.getValue()){A[z.name]=z.getValue()}}}o.baseParams.conditions=Ext.util.JSON.encode(A);var B=new Object();B.start=0;o.load({params:B})}var c=Ext.data.Record.create([{name:"pgPletId",type:"String"},{name:"userId",type:"String"},{name:"menuId",type:"String"},{name:"compoId",type:"String"},{name:"displayTitle",type:"String"}]);function k(){alert("onSearchAdv")}function j(){showWin("高级搜索",context_g+"/jsp/platform/searchPage.jsp?componame=AP_EXPRESS_APP&pageType=listPage")}function f(C,F){var z={oper_type:"add",pgPletId:"",userId:"",menuId:"",compoId:"",displayTitle:""};var D=grid.getSelectionModel();var E=0;var B=D.getSelected();E=B==null?0:grid.store.indexOf(B);var A=new c(z);grid.stopEditing();o.insert(E,A);grid.startEditing(0,0);A.dirty=true;A.modified=z;if(o.modified.indexOf(A)==-1){o.modified.push(A)}D.selectRow(E,true)}function t(z,C){var B=grid.getSelectionModel();var A=B.getSelections();if(A.length==0){alert("请选择要删除的数据");return}Ext.Msg.confirm("系統提示","确认删除吗?\n(注意,这个客户端删除的动作,数据没有正式提交！)",function(F){if(F!="yes"){return}grid.stopEditing();for(var E=0;E<A.length;E++){var D=A[E];D.data.oper_type="del";if(o.modified.indexOf(D)==-1){o.modified.push(D)}s();o.remove(D)}grid.startEditing(0,0)})}function s(){var z=o.modified.slice(0);var B=[];var A=[];var D=[];var C=false;Ext.each(z,function(E){if(E.data.oper_type=="add"){A.push(E.data)}else{if(E.data.oper_type=="del"){B.push(E.data)}else{D.push(E.data)}}});if(C){return}if(A.length+D.length+B.length==0){alert("你没有对数据做任何变动,不需要要保存!");return}Ext.Msg.confirm("系統提示","你新增"+A.length+"条数据,编辑"+D.length+"条数据,删除"+B.length+"条数据。确认这些操作吗?",function(E){if(E!="yes"){return}g.showSaveProgressBar();g.executeAjax(function(G){g.hideSaveProgressBar();alert(G.message);if(G.ret){o.pruneModifiedRecords=true;o.modified=[];for(i=0,cnt=o.getCount();i<cnt;i+=1){var F=o.getAt(i);F.dirty=false}grid.view.refresh()}},"apService.saveExpressApp",new ufgov.portal.common.Param(A,"0:com.ufgov.portal.tools.ap.domain.ApExpressApp"),new ufgov.portal.common.Param(B,"0:com.ufgov.portal.tools.ap.domain.ApExpressApp"),new ufgov.portal.common.Param(D,"0:com.ufgov.portal.tools.ap.domain.ApExpressApp"))})}Ext.override(Ext.grid.RowSelectionModel,{onEditorKey:function(E,D){var B=D.getKey(),F,C=this.grid,A=C.activeEditor;var z=D.shiftKey;if(B==D.ENTER){D.stopEvent();A.completeEdit();if(z){F=C.walkCells(A.row,A.col-1,-1,this.acceptsNav,this)}else{F=C.walkCells(A.row,A.col+1,1,this.acceptsNav,this)}}else{if(B==D.TAB){D.stopEvent();A.completeEdit();if(this.moveEditorOnEnter!==false){if(z){F=C.walkCells(A.row-1,A.col,-1,this.acceptsNav,this)}else{F=C.walkCells(A.row+1,A.col,1,this.acceptsNav,this)}}}else{if(B==D.ESC){A.cancelEdit()}}}if(F){C.startEditing(F[0],F[1])}}});var q=new Ext.grid.RowSelectionModel({moveEditorOnEnter:true,singleSelect:true,listeners:{rowselect:function(B,A,z){centerForm.getForm().loadRecord(z)}}});h()});