Ext.lib.Ajax.isCrossDomain=function(b){var a=/(?:(\w*:)\/\/)?([\w\.]*(?::\d*)?)/.exec(b);if(!a[1]){return false}return(a[1]!=location.protocol)||(a[2]!=location.host)};Ext.override(Ext.data.Connection,{request:function(e){if(this.fireEvent("beforerequest",this,e)!==false){var c=e.params;if(typeof c=="function"){c=c.call(e.scope||window,e)}if(typeof c=="object"){c=Ext.urlEncode(c)}if(this.extraParams){var h=Ext.urlEncode(this.extraParams);c=c?(c+"&"+h):h}var b=e.url||this.url;if(typeof b=="function"){b=b.call(e.scope||window,e)}if(e.form){var d=Ext.getDom(e.form);b=b||d.action;var j=d.getAttribute("enctype");if(e.isUpload||(j&&j.toLowerCase()=="multipart/form-data")){return this.doFormUpload(e,c,b)}var i=Ext.lib.Ajax.serializeForm(d);c=c?(c+"&"+i):i}var k=e.headers;if(this.defaultHeaders){k=Ext.apply(k||{},this.defaultHeaders);if(!e.headers){e.headers=k}}var a=e.method||this.method||(c?"POST":"GET");if(a=="GET"&&(this.disableCaching&&e.disableCaching!==false)||e.disableCaching===true){b+=(b.indexOf("?")!=-1?"&":"?")+"_dc="+(new Date().getTime())}if(typeof e.autoAbort=="boolean"){if(e.autoAbort){this.abort()}}else{if(this.autoAbort!==false){this.abort()}}if((a=="GET"&&c)||e.xmlData||e.jsonData){b+=(b.indexOf("?")!=-1?"&":"?")+c;c=""}var g={success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{options:e},timeout:this.timeout};if(e.scriptTag||this.scriptTag||Ext.lib.Ajax.isCrossDomain(b)){this.transId=this.scriptRequest(a,b,g,c,e)}else{this.transId=Ext.lib.Ajax.request(a,b,g,c,e)}return this.transId}else{Ext.callback(e.callback,e.scope,[e,null,null]);return null}},scriptRequest:function(a,c,e,f,i){var b=++Ext.data.ScriptTagProxy.TRANS_ID;var h={id:b,cb:i.callbackName||"stcCallback"+b,scriptId:"stcScript"+b,options:i};c+=(c.indexOf("?")!=-1?"&":"?")+f+String.format("&{0}={1}",i.callbackParam||this.callbackParam||"callback",h.cb);var d=this;window[h.cb]=function(j){d.handleScriptResponse(j,h)};h.timeoutId=this.handleScriptFailure.defer(e.timeout,this,[h]);var g=document.createElement("script");g.setAttribute("src",c);g.setAttribute("type","text/javascript");g.setAttribute("id",h.scriptId);document.getElementsByTagName("head")[0].appendChild(g);return h},handleScriptResponse:function(d,b){this.transId=false;this.destroyScriptTrans(b,true);var a=b.options;var c;if(typeof d=="string"){if(window.ActiveXObject){c=new ActiveXObject("Microsoft.XMLDOM");c.async="false";c.loadXML(d)}else{c=new DOMParser().parseFromString(d,"text/xml")}}response={responseObject:d,responseText:(typeof d=="object")?Ext.util.JSON.encode(d):String(d),responseXML:c,argument:a.argument};this.fireEvent("requestcomplete",this,response,a);Ext.callback(a.success,a.scope,[response,a]);Ext.callback(a.callback,a.scope,[a,true,response])},handleScriptFailure:function(b){this.transId=false;this.destroyScriptTrans(b,false);var a=b.options;response={argument:a.argument,status:500,statusText:"Server failed to respond",responseText:""};this.fireEvent("requestexception",this,response,a,{status:-1,statusText:"communication failure"});Ext.callback(a.failure,a.scope,[response,a]);Ext.callback(a.callback,a.scope,[a,false,response])},destroyScriptTrans:function(b,a){document.getElementsByTagName("head")[0].removeChild(document.getElementById(b.scriptId));clearTimeout(b.timeoutId);if(a){window[b.cb]=undefined;try{delete window[b.cb]}catch(c){}}else{window[b.cb]=function(){window[b.cb]=undefined;try{delete window[b.cb]}catch(d){}}}}});Ext.lib.Ajax.asyncRequest=function(e,b,d,a){var c=this.getConnectionObject();if(!c){return null}else{if(d.argument.options.synchronize==true){c.conn.open(e,b,false)}else{c.conn.open(e,b,true)}if(this.useDefaultXhrHeader){if(!this.defaultHeaders["X-Requested-With"]){this.initHeader("X-Requested-With",this.defaultXhrHeader,true)}}if(a&&this.useDefaultHeader&&(!this.hasHeaders||!this.headers["Content-Type"])){this.initHeader("Content-Type",this.defaultPostHeader)}if(this.hasDefaultHeaders||this.hasHeaders){this.setHeader(c)}if(d.argument.options.synchronize==true){}else{this.handleReadyState(c,d)}c.conn.send(a||null);return c}};