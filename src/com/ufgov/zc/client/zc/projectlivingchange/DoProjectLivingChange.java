package com.ufgov.zc.client.zc.projectlivingchange;import java.text.SimpleDateFormat;import java.util.Date;import com.ufgov.zc.client.common.ServiceFactory;import com.ufgov.zc.client.common.WorkEnv;import com.ufgov.zc.common.system.RequestMeta;import com.ufgov.zc.common.system.exception.OtherException;import com.ufgov.zc.common.zc.model.ZcEbPack;import com.ufgov.zc.common.zc.model.ZcEbProjChange;import com.ufgov.zc.common.zc.publish.IZcEbProjChangeServiceDelegate;public class DoProjectLivingChange {  private RequestMeta requestMeta = WorkEnv.getInstance().getRequestMeta();  private ZcEbPack zcEbPack;  private String changeType;  private String changeReason;  public IZcEbProjChangeServiceDelegate zcEbProjChangeServiceDelegate = (IZcEbProjChangeServiceDelegate) ServiceFactory.create(  IZcEbProjChangeServiceDelegate.class, "zcEbProjChangeServiceDelegate");  public DoProjectLivingChange(ZcEbPack zcEbPack, String changeType, String changeReason) {    this.zcEbPack = zcEbPack;    this.changeType = changeType;    this.changeReason = changeReason;  }  /**   * 1、现场采购方式变更保存变更数据到Zc_Eb_Proj_CHG表中。采购方式变更金额是标段的预算。   * 2、立完项 后的采购变更要更新标段的采购方式。   * 3、后续业务采购方式的显示取标段的采购方式。   */  public void startChange() throws OtherException {    /**     * 现场采购方式变更记录   insert 或 update 的判断 通过 pack_code、pur_type、bid_sum的金额进行区分。     * 若pack_code、pur_type、bid_sum 全都一致 执行 delete insert 操作。若其中有一个条件不满足 执行 insert 操作。     */    ZcEbProjChange projChange = new ZcEbProjChange();    projChange.setProjCode(zcEbPack.getEntrust().getZcMakeCode());    projChange.setProjName(zcEbPack.getEntrust().getZcMakeName());    projChange.setManager(zcEbPack.getEntrust().getZcInputCode());    projChange.setStatus("0");    projChange.setNd(zcEbPack.getEntrust().getNd());    projChange.setPurType(changeType);//变更后的采购方式    projChange.setPurLstType(zcEbPack.getPurType());//原采购方式    zcEbPack.setPurType(changeType);    //变更金额    projChange.setProjSum(zcEbPack.getPackBudget());    //总    projChange.setProjSrcSum(zcEbPack.getEntrust().getZcMoneyBiSum());    projChange.setCoCode(zcEbPack.getEntrust().getCoCode());    SimpleDateFormat dateFormate = new SimpleDateFormat("yyyyMMdd-HH:mm:ss");    projChange.setChgId(projChange.getProjCode() + "-变更[" + dateFormate.format(new Date()) + "]");    projChange.setChangeReasonMemo(changeReason);    projChange.setPackCode(zcEbPack.getPackCode());    projChange.setPackName(zcEbPack.getPackDesc());    projChange.setInputDate(new Date());    zcEbProjChangeServiceDelegate.saveLivingPurTypeChange(projChange, requestMeta);  }}