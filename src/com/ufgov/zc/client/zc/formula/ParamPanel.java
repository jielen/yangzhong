/**   * @(#) project: GK* @(#) file: ParamPanel.java* * Copyright 2010 UFGOV, Inc. All rights reserved.* UFGOV PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.* */package com.ufgov.zc.client.zc.formula;import java.awt.BorderLayout;import java.awt.Color;import java.awt.Font;import java.awt.event.ActionEvent;import java.awt.event.ActionListener;import java.util.ArrayList;import java.util.Arrays;import java.util.List;import javax.swing.BorderFactory;import javax.swing.JButton;import javax.swing.JOptionPane;import javax.swing.JPanel;import javax.swing.JTabbedPane;import javax.swing.border.TitledBorder;import org.apache.log4j.Logger;import com.ufgov.smartclient.component.table.fixedtable.JPageableFixedTable;import com.ufgov.zc.client.common.LangTransMeta;import com.ufgov.zc.client.component.JFuncToolBar;import com.ufgov.zc.client.component.JTablePanel;import com.ufgov.zc.client.component.button.FuncButton;import com.ufgov.zc.client.component.button.SaveButton;import com.ufgov.zc.client.component.button.SubaddButton;import com.ufgov.zc.client.component.button.SubdelButton;import com.ufgov.zc.client.component.button.SubinsertButton;import com.ufgov.zc.client.component.table.BeanTableModel;import com.ufgov.zc.client.component.table.ColumnBeanPropertyPair;import com.ufgov.zc.client.component.table.celleditor.TextCellEditor;import com.ufgov.zc.client.component.table.codecelleditor.AsValComboBoxCellEditor;import com.ufgov.zc.client.component.table.codecellrenderer.AsValCellRenderer;import com.ufgov.zc.client.util.SwingUtil;import com.ufgov.zc.common.system.constants.ZcElementConstants;import com.ufgov.zc.common.zc.model.ZcEbFormula;import com.ufgov.zc.common.zc.model.ZcEbFormulaParam;/*** @ClassName: ParamPanel* @Description: 通用参数设置面板* @date: 2010-5-7 上午09:54:10* @version: V1.0 * @since: 1.0* @author: fanpl* @modify: */@SuppressWarnings("unchecked")public class ParamPanel extends JPanel {  private static final Logger logger = Logger.getLogger(ParamPanel.class);  protected JFuncToolBar topToolBar = new JFuncToolBar();  protected JFuncToolBar bottomToolBar = new JFuncToolBar();  private JTablePanel tablePanel = new JTablePanel();  private JTabbedPane tabbedPane = new JTabbedPane();  private String compoId = "ZC_EB_FORMULA";  private FuncButton addBtn = new SubaddButton(false);  private JButton insertBtn = new SubinsertButton(false);  private JButton delBtn = new SubdelButton(false);  private ZcEbFormula zcEbFormula;  private FormulaSetMainPanel formulaSetMainPanel;  public FormulaSetMainPanel getFormulaSetMainPanel() {    return formulaSetMainPanel;  }  public void setFormulaSetMainPanel(FormulaSetMainPanel formulaSetMainPanel) {    this.formulaSetMainPanel = formulaSetMainPanel;  }  private BeanTableModel<ZcEbFormulaParam> model;  List<ZcEbFormulaParam> mydataList;  List<ColumnBeanPropertyPair> columnList;  static {    LangTransMeta.init("ZC%");  }  public ParamPanel(ZcEbFormula zcEbFormula) {    this.zcEbFormula = zcEbFormula;    init();  }  public void init() {    this.setLayout(new BorderLayout());    tablePanel.init();    tablePanel.getSearchBar().setVisible(false);    tablePanel.setTablePreferencesKey(this.getClass().getName() + "_table");    tablePanel.getTable().setShowCheckedColumn(false);    refreshData();    tabbedPane.add("通用参数", tablePanel);    JPanel workPanel = new JPanel();    workPanel.setLayout(new BorderLayout());    workPanel.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEtchedBorder(), "通用参数设置", TitledBorder.CENTER, TitledBorder.TOP,    new Font("宋体", Font.BOLD, 15), Color.BLUE));    addToolBarComponent(bottomToolBar, topToolBar);    workPanel.add(bottomToolBar, BorderLayout.SOUTH);    workPanel.add(tabbedPane, BorderLayout.CENTER);    this.add(topToolBar, BorderLayout.NORTH);    this.add(workPanel, BorderLayout.CENTER);  }  public void refreshData() {    columnList = getPair();    model = new BeanTableModel<ZcEbFormulaParam>();    model.setEditable(true);    model.setOidFieldName("paramCode");    model.setDataBean(zcEbFormula.getParamList(), columnList);    tablePanel.setTableModel(model);    setTableEditor(tablePanel.getTable());  }  public static List<ColumnBeanPropertyPair> getPair() {    List<ColumnBeanPropertyPair> pairList = new ArrayList<ColumnBeanPropertyPair>();    ColumnBeanPropertyPair parir0 = new ColumnBeanPropertyPair();    parir0.setBeanPropertyName("paramName");    parir0.setColumnIdentifier(LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_ZC_EB_FORMULA_PARAM_NAME));    pairList.add(parir0);    ColumnBeanPropertyPair parir1 = new ColumnBeanPropertyPair();    parir1.setBeanPropertyName("description");    parir1.setColumnIdentifier(LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_ZC_EB_FORMULA_PARAM_DESCRIPTION));    pairList.add(parir1);    ColumnBeanPropertyPair parir2 = new ColumnBeanPropertyPair();    parir2.setBeanPropertyName("defaultValue");    parir2.setColumnIdentifier(LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_ZC_EB_FORMULA_PARAM_DEFAULTVALUE));    pairList.add(parir2);    //是否需要人工设置参数值    ColumnBeanPropertyPair parir3 = new ColumnBeanPropertyPair();    parir3.setBeanPropertyName("isManSet");    parir3.setColumnIdentifier(LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_ZC_EB_FORMULA_PARAM_ISMANSET));    pairList.add(parir3);    return pairList;  }  protected void addToolBarComponent(JFuncToolBar bottomToolBar, JFuncToolBar topToolBar) {    topToolBar.setModuleCode("ZC");    topToolBar.setCompoId(compoId);    bottomToolBar.add(addBtn);    bottomToolBar.add(insertBtn);    bottomToolBar.add(delBtn);    addBtn.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        add();      }    });    insertBtn.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        insert();      }    });    delBtn.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        delete();      }    });  }  private void add() {    tablePanel.getTable().clearSelection();    if (tablePanel.getTable().isEditing()) {      tablePanel.getTable().getCellEditor().stopCellEditing();    }    ZcEbFormulaParam bean = new ZcEbFormulaParam();    bean.setFormulaCode(zcEbFormula.getFormulaCode());    bean.setIsManSet("Y");    model.insertRow(model.getRowCount(), bean);  }  private void insert() {    if (tablePanel.getTable().isEditing()) {      tablePanel.getTable().getCellEditor().stopCellEditing();    }    ZcEbFormulaParam bean = new ZcEbFormulaParam();    int selectedRow = tablePanel.getTable().getSelectedRow();    if (selectedRow != -1) {      model.insertRow(selectedRow + 1, bean);    } else {      model.insertRow(model.getRowCount(), bean);    }  }  private void delete() {    JPageableFixedTable table = tablePanel.getTable();    if (table.isEditing()) {      table.getCellEditor().stopCellEditing();    }    int[] selectedRows = table.getSelectedRows();    if (selectedRows.length == 0) {      JOptionPane.showMessageDialog(this, "没有选择数据！", "提示", JOptionPane.INFORMATION_MESSAGE);      return;    }    int[] selRows = new int[selectedRows.length];    for (int i = 0; i < selRows.length; i++) {      selRows[i] = table.convertRowIndexToModel(selectedRows[i]);    }    Arrays.sort(selRows);    for (int i = selRows.length - 1; i >= 0; i--) {      model.deleteRow(selRows[i]);    }  }  private void setTableEditor(final JPageableFixedTable table) {    table.setDefaultEditor(String.class, new TextCellEditor());    AsValComboBoxCellEditor asValComboBoxCellEditor = new AsValComboBoxCellEditor("ZC_VS_YN");    SwingUtil    .setTableCellEditor(table, LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_ZC_EB_FORMULA_PARAM_ISMANSET), asValComboBoxCellEditor);    SwingUtil.setTableCellRenderer(table, LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_ZC_EB_FORMULA_PARAM_ISMANSET),    new AsValCellRenderer("ZC_VS_YN"));  }  protected boolean beforeSave() {    if (null == model.getDataBeanList() || model.getDataBeanList().isEmpty()) {      return false;    }    stopEdit();    return true;  }  public void stopEdit() {    if (null != tablePanel.getTable().getCellEditor()) {      tablePanel.getTable().getCellEditor().stopCellEditing();    }  }  public void doEidt(boolean isVisiable){    this.addBtn.setVisible(isVisiable);    this.delBtn.setVisible(isVisiable);    this.insertBtn.setVisible(isVisiable);  }}