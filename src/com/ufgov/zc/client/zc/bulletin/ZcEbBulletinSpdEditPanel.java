package com.ufgov.zc.client.zc.bulletin;import java.util.List;import javax.swing.JOptionPane;import com.ufgov.smartclient.common.UIUtilities;import com.ufgov.zc.client.common.AsOptionMeta;import com.ufgov.zc.client.common.ListCursor;import com.ufgov.zc.client.component.GkBaseDialog;import com.ufgov.zc.client.zc.WordFileUtil;import com.ufgov.zc.common.system.constants.ZcSettingConstants;import com.ufgov.zc.common.system.exception.BaseException;import com.ufgov.zc.common.system.util.ObjectUtil;import com.ufgov.zc.common.zc.ZcEbBulletinConstants;import com.ufgov.zc.common.zc.model.ZcEbBulletin;import com.ufgov.zc.common.zc.model.ZcEbPack;import com.ufgov.zc.common.zc.model.ZcEbProjZbFile;public class ZcEbBulletinSpdEditPanel extends AbstractZcEbBulletinEditPanel {  public ZcEbBulletinSpdEditPanel(GkBaseDialog parent, ListCursor listCursor, String tabStatus, ZcEbBulletinSpdListPanel listPanel) {    super(parent, listCursor, tabStatus, listPanel, ZcEbBulletinConstants.COMPO_ZC_EB_BULLETIN_SPD);  }  protected String getCompId() {    return ZcEbBulletinConstants.COMPO_ZC_EB_BULLETIN_SPD;  }  public String fetchSn(ZcEbBulletin sheet) {    List<ZcEbPack> pack = zcEbBaseServiceDelegate.queryDataForList("ZcEbProj.getZcEbPackListByProjCode", sheet.getProjCode(), requestMeta);    return pack.get(0).getEntrustCode();  }  @Override  protected String getModelName() {    // TODO Auto-generated method stub    return ZcEbBulletinConstants.TITLE_ZC_EB_BULLETIN_SPD;  }  @Override  protected String getBulletinType() {    // TODO Auto-generated method stub    return ZcEbBulletinConstants.TYPE_BULLETIN_SPD;  }  public boolean doPublish() {    if (isDataChanged()) {      int num = JOptionPane.showConfirmDialog(this, "当前页面数据已修改，是否要保存", "保存确认", 0);      if (num == JOptionPane.YES_OPTION) {        if (!doSave(true)) {          return false;        }      } else {        listCursor.setCurrentObject(oldBulletin);      }    }    ZcEbBulletin bulletin = (ZcEbBulletin) this.getEditingObject();    if (bulletin == null)      bulletin = (ZcEbBulletin) listCursor.getCurrentObject();    if (bulletin.getBulletinStatus().equalsIgnoreCase(ZcEbBulletinConstants.STATUS_BULLETIN_BID_PUBLISHED)) {      UIUtilities.showStaickTraceDialog(new BaseException(), this, "错误", "公告已经发布,不需要再发布!");      return false;    }    ZcEbProjZbFile zcEbProjZbFile = this.getIZcEbBulletinServiceDelegate().getZcEbProjZbFile(bulletin.getProjCode(), "0", requestMeta);    String title = bulletin.getProjName() + "暂停公告";    String href = "";    String attachFileName = "";    if (zcEbProjZbFile != null && zcEbProjZbFile.getFileName() != null)      attachFileName = zcEbProjZbFile.getFileName();    href = WordFileUtil.getPortalHref(bulletin.getFileID());    String pletID = AsOptionMeta.getOptVal("OPT_ZC_PLET_SPD");    //插入暂停文件并转换公告为html网页    if (!publishToHtml(bulletin.getFileID()))      return false;    //把生成的html网页写入门户招标公告栏目    //    boolean ifPubSuccess = this.getIZcEbBulletinServiceDelegate().pubBulletin(title, this.requestMeta.getSvUserName(), href, pletID, requestMeta,    //      bulletin);    //    if (!ifPubSuccess) {    //      UIUtilities.showStaickTraceDialog(new BaseException(), this, "错误", "向外网发布公告失败!");    //      return false;    //    }    bulletin.setBulletinStatus(ZcEbBulletinConstants.STATUS_BULLETIN_BID_PUBLISHED);    bulletin.setEffectiveDate(new java.util.Date());    this.getIZcEbBulletinServiceDelegate().updateFN(bulletin, requestMeta);    this.listCursor.setCurrentObject(bulletin);    this.oldBulletin = (ZcEbBulletin) ObjectUtil.deepCopy(bulletin);    this.listPanel.refreshCurrentTabData();    JOptionPane.showMessageDialog(self, "发布成功！", "提示", JOptionPane.INFORMATION_MESSAGE);    this.pageStatus = ZcSettingConstants.PAGE_STATUS_BROWSE;    updateFieldEditorsEditable();    setButtonStatus();    refreshMainData();    return true;  }  public String getSqlMapSelectedMold() {    return "ZcEbBulletinWordMold.getZcEbBulletinWordMoldSpd";  }}