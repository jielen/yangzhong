/** * ZcEbXieYiListPanel.java * com.ufgov.gk.client.zc.zcebxy * Administrator * 2010-11-6 */package com.ufgov.zc.client.zc.zcebxy;import java.awt.Color;import java.awt.Container;import java.awt.Font;import java.awt.Window;import java.awt.event.MouseAdapter;import java.awt.event.MouseEvent;import java.util.HashMap;import java.util.List;import java.util.Map;import javax.swing.BorderFactory;import javax.swing.JFrame;import javax.swing.SwingUtilities;import javax.swing.UIManager;import javax.swing.border.TitledBorder;import javax.swing.table.TableModel;import com.ufgov.smartclient.common.DefaultInvokeHandler;import com.ufgov.smartclient.common.UIUtilities;import com.ufgov.smartclient.component.table.JGroupableTable;import com.ufgov.smartclient.plaf.BlueLookAndFeel;import com.ufgov.zc.client.common.LangTransMeta;import com.ufgov.zc.client.common.ListCursor;import com.ufgov.zc.client.common.MyTableModel;import com.ufgov.zc.client.common.ParentWindowAware;import com.ufgov.zc.client.common.WorkEnv;import com.ufgov.zc.client.common.converter.zc.ZcPProMakeToTableModelConverter;import com.ufgov.zc.client.component.JFuncToolBar;import com.ufgov.zc.client.component.button.HelpButton;import com.ufgov.zc.client.component.ui.AbstractDataDisplay;import com.ufgov.zc.client.component.ui.AbstractEditListBill;import com.ufgov.zc.client.component.ui.AbstractSearchConditionArea;import com.ufgov.zc.client.component.ui.MultiDataDisplay;import com.ufgov.zc.client.component.ui.SaveableSearchConditionArea;import com.ufgov.zc.client.component.ui.TableDisplay;import com.ufgov.zc.client.component.ui.conditionitem.AbstractSearchConditionItem;import com.ufgov.zc.client.component.ui.conditionitem.SearchConditionUtil;import com.ufgov.zc.client.util.ListUtil;import com.ufgov.zc.common.commonbiz.model.SearchCondition;import com.ufgov.zc.common.system.constants.ZcElementConstants;import com.ufgov.zc.common.system.constants.ZcSettingConstants;import com.ufgov.zc.common.system.util.ObjectUtil;/** * @author Administrator * */public class ZcEbXieYiListPanel extends AbstractEditListBill implements ParentWindowAware {  /**   *    */  private static final long serialVersionUID = 585209214683030223L;  private ZcEbXieYiListPanel self = this;  final protected ZcEbXieYiClientService service = new ZcEbXieYiClientService();  private Window parentWindow;  private HelpButton helpButton = new HelpButton();  private AbstractSearchConditionArea topSearchConditionArea;  public ZcEbXieYiListPanel() {    UIUtilities.asyncInvoke(new DefaultInvokeHandler<List<SearchCondition>>() {      @Override      public List<SearchCondition> execute() throws Exception {        List<SearchCondition> needDisplaySearchConditonList = SearchConditionUtil.getNeedDisplaySearchConditonList(WorkEnv.getInstance()        .getCurrUserId(), ZcSettingConstants.TAB_ID_ZC_EB_XIEYI);        return needDisplaySearchConditonList;      }      @Override      public void success(List<SearchCondition> needDisplaySearchConditonList) {        List<TableDisplay> showingDisplays = SearchConditionUtil.getNeedDisplayTableDisplay(needDisplaySearchConditonList);        init(createDataDisplay(showingDisplays), null);//调用父类方法        revalidate();        repaint();      }    });  }  private AbstractSearchConditionArea createTopConditionArea() {    Map defaultValueMap = new HashMap();    topSearchConditionArea = new SaveableSearchConditionArea(ZcSettingConstants.CONDITION_ID_ZC_EB_XIEYI, null, false, defaultValueMap, null);    return topSearchConditionArea;  }  public String getTitle() {    return LangTransMeta.translate(ZcElementConstants.ZC_XIEYI_DIANZI_JJ_TITLE_FOR_SUPPLIER);  }  private final class DataDisplay extends MultiDataDisplay {    private DataDisplay(List<TableDisplay> displays, List<TableDisplay> showingDisplays, AbstractSearchConditionArea conditionArea,    boolean showConditionArea) {      super(displays, showingDisplays, conditionArea, showConditionArea, ZcSettingConstants.TAB_ID_ZC_EB_XIEYI);//LangTransMeta.translate(compoId)      setBorder(BorderFactory.createTitledBorder(BorderFactory.createEtchedBorder(), getTitle(),      TitledBorder.CENTER, TitledBorder.TOP, new Font("宋体", Font.BOLD, 15), Color.BLUE));    }    protected void preprocessShowingTableDisplay(List<TableDisplay> showingTableDisplays) {      for (final TableDisplay d : showingTableDisplays) {        final JGroupableTable table = d.getTable();        table.addMouseListener(new MouseAdapter() {          public void mouseClicked(MouseEvent e) {            if (e.getClickCount() == 2 && SwingUtilities.isLeftMouseButton(e)) {              String tabStatus = d.getStatus();              JGroupableTable table = d.getTable();              MyTableModel model = (MyTableModel) table.getModel();              int row = table.getSelectedRow();              List viewList = (List) ObjectUtil.deepCopy(ListUtil.convertToTableViewOrderList(model.getList(), table));              ZcEbXieYiListPanel.this.service.setListCursor(new ListCursor(viewList, row));              new ZcEbXieYiDialog(self, row, tabStatus);            }          }        });      }    }    @Override    protected void handleTableDisplayActived(AbstractSearchConditionItem[] searchConditionItems, final TableDisplay tableDisplay) {      ZcEbXieYiListPanel.this.service.getElementConditionDto().setWfcompoId(ZcEbXieYiListPanel.this.service.getCompoId());      ZcEbXieYiListPanel.this.service.getElementConditionDto().setExecutor(ZcEbXieYiListPanel.this.service.getWorkEnv().getCurrUserId());      ZcEbXieYiListPanel.this.service.getElementConditionDto().setNd(ZcEbXieYiListPanel.this.service.getWorkEnv().getTransNd());      ZcEbXieYiListPanel.this.service.getElementConditionDto().setStatus(tableDisplay.getStatus());      for (AbstractSearchConditionItem item : searchConditionItems) {        item.putToElementConditionDto(ZcEbXieYiListPanel.this.service.getElementConditionDto());      }      final Container c = tableDisplay.getTable().getParent();      UIUtilities.asyncInvoke(new DefaultInvokeHandler<TableModel>() {        @Override        public void before() {          assert c != null;          installLoadingComponent(c);        }        @Override        public void after() {          assert c != null;          unInstallLoadingComponent(c);          c.add(tableDisplay.getTable());        }        @Override        public TableModel execute() throws Exception {          String userID = ZcEbXieYiListPanel.this.service.getRequestMeta().getSvUserID();          ZcEbXieYiListPanel.this.service.getElementConditionDto().setExecutor(userID);          return ZcPProMakeToTableModelConverter.convertToTableModel_dzjj(ZcEbXieYiListPanel.this.service.getZcPProMakeServiceDelegate()          .getZcPProMakeXieYi(ZcEbXieYiListPanel.this.service.getElementConditionDto(), ZcEbXieYiListPanel.this.service.getRequestMeta()));        }        @Override        public void success(TableModel model) {          tableDisplay.setTableModel(model);        }      });    }  }  private AbstractDataDisplay createDataDisplay(List<TableDisplay> showingDisplays) {    return new DataDisplay(SearchConditionUtil.getAllTableDisplay(ZcSettingConstants.TAB_ID_ZC_EB_XIEYI), showingDisplays, createTopConditionArea(),    true);//true:显示收索条件区 false：不显示收索条件区  }  @Override  protected void addToolBarComponent(JFuncToolBar toolBar) {    toolBar.setModuleCode(this.service.getModuleCode());    toolBar.setCompoId(this.service.getCompoId());    toolBar.add(helpButton);  }  @Override  public Window getParentWindow() {    return this.parentWindow;  }  @Override  public void setParentWindow(Window window) {    this.parentWindow = window;  }  /**   * @param args   * Administrator   * 2010-11-6   */  public static void main(String[] args) {    SwingUtilities.invokeLater(new Runnable() {      public void run() {        try {          UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());          UIManager.setLookAndFeel(new BlueLookAndFeel());        } catch (Exception e) {          e.printStackTrace();        }        //        UIManager.getDefaults().put("SplitPaneUI", BigButtonSplitPaneUI.class.getName());        ZcEbXieYiListPanel bill = new ZcEbXieYiListPanel();        JFrame frame = new JFrame("frame");        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);        frame.setSize(800, 600);        frame.setLocationRelativeTo(null);        frame.getContentPane().add(bill);        frame.setVisible(true);      }    });  }  public void refreshCurrentTabData() {    topSearchConditionArea.doSearch();  }}