/**   * @(#) project: GK* @(#) file: ZcEbZTBFilePanel.java* * Copyright 2010 UFGOV, Inc. All rights reserved.* UFGOV PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.* */package com.ufgov.zc.client.zc.expertEval.component.ztbPanel;import java.awt.BorderLayout;import java.awt.Rectangle;import java.beans.PropertyChangeEvent;import java.beans.PropertyChangeListener;import java.io.File;import java.util.Enumeration;import java.util.List;import javax.swing.JLabel;import javax.swing.JProgressBar;import javax.swing.SwingUtilities;import javax.swing.tree.DefaultTreeModel;import com.ufgov.zc.client.zc.expertEval.service.DownLoadZtbFileService;import com.ufgov.zc.client.zc.ztb.component.MainPanel;import com.ufgov.zc.client.zc.ztb.model.SmartTreeNode;import com.ufgov.zc.client.zc.ztb.service.ReadTbFileService;import com.ufgov.zc.client.zc.ztb.util.EventPropertyName;import com.ufgov.zc.client.zc.ztb.util.GV;import com.ufgov.zc.common.zc.model.EvalExpert;import com.ufgov.zc.common.zc.model.ZcEbEvalPack;/*** @ClassName: ZcEbZTBFilePanel* @Description: 评标招投标文件显示基础面板。* @date: 2010-5-7 下午04:48:15* @version: V1.0 * @since: 1.0* @author: tianly* @modify: */public class ZcEbEvalZTBFileBasePanel extends MainPanel {  private static final long serialVersionUID = -4616322236341764815L;  protected static final boolean tableIsReadOnly = true;  private String ztbFileName;  protected String filePath;  /**   * 招投标文件ID。   */  protected String ztbFileID;  private DownLoadZtbFileService downLoadZtbFileService = new DownLoadZtbFileService();  /**   * 评标标段对象   */  protected ZcEbEvalPack evalPack;  protected EvalExpert evalExpert;  public EvalExpert getEvalExpert() {    return evalExpert;  }  public void setEvalExpert(EvalExpert evalExpert) {    this.evalExpert = evalExpert;  }  protected JLabel msgLabel;  //招投标文件是否已经下载过  protected boolean ztbFileExsits;  protected String getFilePath() {    return filePath;  }  protected void setFilePath(String filePath) {    this.filePath = filePath;  }  public ZcEbEvalPack getEvalPack() {    return evalPack;  }  public void setEvalPack(ZcEbEvalPack evalPack) {    this.evalPack = evalPack;  }  public String getZtbFileName() {    return ztbFileName;  }  public void setZtbFileName(String ztbFileName) {    this.ztbFileName = ztbFileName;  }  public static long getSerialversionuid() {    return serialVersionUID;  }  @Override  public void paintPanel() {    this.setLayout(new BorderLayout());    this.add(this.splitPane, BorderLayout.CENTER);  }  protected JLabel createMsgLabel(String msg) {    JLabel label = new JLabel(msg);    label.setHorizontalAlignment(SwingUtilities.CENTER);    return label;  }  private static JProgressBar progressBar = null;  private static JProgressBar getProgressBar(int len) {    if (len == 0) {      len = 100;    }    if (progressBar == null) {      progressBar = new JProgressBar(0, len);      progressBar.setStringPainted(true);      progressBar.setBounds(new Rectangle(101, 305, 420, 30));    }    return progressBar;  }  public static void publishProgressMsg(String msg) {    getProgressBar(0).setString(msg);  }  protected void downloadZbFile(ZcEbEvalPack zcEbEvalPack, String fileID, String filePath) {    if (null != fileID && !"".equals(fileID.trim())) {      try {        //招标文件存放在数据库中，从数据库中取招标文件。        downLoadZtbFileService.downLoadZbFile(zcEbEvalPack, fileID, filePath);      } catch (Exception e) {        System.out.println(e.getMessage());        return;      }      if (leftPane == null) {        System.out.println("---------inintPanel:");        initPanel();      } else {        System.out.println("---------refreshPanel:");        refreshPanel();      }    }  }  public void refreshPanel() {    try {      refreshLeftTreePanel();    } catch (Exception e) {      e.printStackTrace();    }    //    refreshRightPanel();    expandOrClose(true, true);    splitPane.revalidate();    splitPane.repaint();  }  public void refreshLeftTreePanel() {    initLeftFilesTreePanel();  }  @Override  public void initLeftFilesTreePanel() {    if (null == getZtbFileName() || "".equals(getZtbFileName())) {      return;    }    if (!checkFileExits(getZtbFileName())) {      ztbFileExsits = false;      return;    }    ztbFileExsits = true;    ReadTbFileService readTbFileService = new ReadTbFileService();    System.out.println("初始化树");    singleSeletionTree = readTbFileService.createZTBSTreePanel(getZtbFileName(), this);    //    List<SmartTreeNode> hideNodes = new ArrayList<SmartTreeNode>();    //    hideNode(hideNodes);    //显示招标文件节点，隐藏其他节点。    singleSeletionTree.getTree().setRootVisible(true);    openAndProtect = true;    singleSeletionTree.addPropertyChangeListener(EventPropertyName.MOUSE_DBCLICK_PROPERTY_NAME, new PropertyChangeListener() {      public void propertyChange(PropertyChangeEvent evt) {        showTreeNodeInfo(getFilePath() + File.separator + singleSeletionTree.getCurrentNode().getNodesFullPath()        + singleSeletionTree.getCurrentNode().getFileExtension());      }    });  }  /**   *   * @Description: 隐藏数节点，招标文件树只显示招标招标文件节点和当前评标分包的标段信息。  * @return void 返回类型  * @since 1.0   */  private void hideNode(List<SmartTreeNode> hideNodes) {    SmartTreeNode rootNode = singleSeletionTree.getTreeNode();    Enumeration<?> enumeration = rootNode.children();    while (enumeration.hasMoreElements()) {      SmartTreeNode node = (SmartTreeNode) enumeration.nextElement();      if (this instanceof ZcEbEvalZBFilePanel) {        if (node.getNodeType().equals(GV.NODE_TYPE_ZB)) {          continue;        } else {          hideNodes.add(node);        }      } else {        if (node.getNodeType().equals(GV.NODE_TYPE_TB)) {          continue;        } else {          hideNodes.add(node);        }      }    }    for (int i = 0; i < hideNodes.size(); i++) {      ((DefaultTreeModel) singleSeletionTree.getTree().getModel()).removeNodeFromParent(hideNodes.get(i));    }    singleSeletionTree.getTree().validate();    singleSeletionTree.getTree().repaint();  }  private boolean checkFileExits(String fileName) {    File file = new File(fileName);    if (file.exists()) {      return true;    }    return false;  }}